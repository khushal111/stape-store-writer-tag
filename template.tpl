___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Stape Store Writer",
  "brand": {
    "id": "github.com_stape-io",
    "displayName": "stape-io",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAACmsSURBVHgB7d3Nj131nefxz40NpDMDMWmi9ORBOSYz05OMMtjKU29muNZk05oFZjSL7ChvRhopCfZfwPVudthJL1q94daqI40E9iK7SL6EDYG0KCeaENQNPoiYbhojKnYGUm4XNed7z724bFe56j6cc36/7/f9kk6XaehOgITf53wffqenRG19/xtD9XpPCADQst6J3o9fHgqufUIAACAcAgAAAAERAAAACIgAAABAQAQAAAACIgAAABAQAQAAgIAIAAAABEQAAAAgIAIAAAABEQAAAAiIAAAAQEAEAAAAAiIAAAAQEAEAAICACAAAAAREAAAAICACAAAAAREAAAAIiAAAAEBABAAAAAIiAAAAEBABAACAgAgAAAAERAAAACAgAgAAAAERAAAACIgAAABAQAQAAAACIgAAABAQAQAAgIAIAAAABEQAAAAgIAIAAAABEQAAAAiIAAAAQEAEAAAAAiIAAAAQEAEAAICACAAAAAREAAAAICACAAAAAREAAAAIiAAAAEBABAAAAAIiAAAAEBABAACAgAgAAIBbHTgwEtwjAAAAbtrS6d6ZF0vBvYMCAGCsV+rggaEQAhUAAMAUb/+BEAAAALK3/96PXx4KYRAAAABV73/rhBAKMwAAEN7WsPdXfzcSQqECAADRHbjntBAOAQAAImPtLyxaAAAQFmt/kVEBAIC4ePsPjAAAACGx9hcdAQAAImLtLzxmAAAgHNb+QAUAAOJh7Q8iAABALKz9YYIWAABkqLy2ofWNTa29+6F+f/3G+Nfl1Y369129Pv7t9eubN//4ye+rPDV57vh/Ofm5ftvz5uTn2uRnOfmJzBEAACBR40O9OujtkL945YPxIb525cPth/kyFTP8sdNAcFF1IFjTzYCATBAAACAB47f56pC3g37t3Q80uvyHpg76ZThUPf3Js52FgLJ6nq+e0eS3kSgCAAB0YHrgn39jXaPfXRv/2oEjk+f45LetIjCqnvOTn6WQDAIAALTEDvnnL1/TuderQ7/6GYBVCo7rZiCwioBVB4aiOtA5AgAANMgOenvLP1c9CZf02zKtEDypuhpglYEzojLQCQIAACzZuLRfveWfufjPVan/hrCjQnUQsMeqAWer55wYJGwNAQAAlsB6+qu/vRKpvL9MVhV4pnqeVh0C7KKiUmgUAQAAFmBv+6uvvqdh9fC2vzCbGViZPCPVQWAkNIIAAABzsLf80794m7f95vQnT6k6CAyFpeIqYACYgR34x559bfxw+LeiUN0euKS6MoAlIQAAwD5w8Heu0M0gcERYGC0AALgLSv3JKarnFdUtAYYFF0AFAAB2YB/U4Y0/aSuqqwFPCXMhAADANrbOd+rnb+nw6q84+PMwUB0E+sJMCAAAMDF89Up18P9aZy6+I2SlqJ4LqmcECmFfmAEAEJ6V+0/87BJv/PlbUV0JOCHuD9gTFQAAoZ1de0dHf/IbDn8/CtXVAGYD9kAAABDSdMjv5AtvcYOfTwPVswGFsCMCAIBwzr3xPm/9MRSqVwZXhDswAwAgDJvwt51+hvxCse8L2HDgl1XfG4AJKgAAQpiW/Dn8wxqorgYUwhgBAIB7Vuq3kr99uQ+h2RXCNiBYCAQAAL5Zyd/e/Bn0w0ShuhLQV3AEAABu2Y1+g5feFnAbmwuwSsBJBcYQIAB3bNjv8Z/+A1P+2MvT1fNpBR0OJAAAcGU87Pfca9XPDQH7MJj8DBcCaAEAcIPDH3MaKODNgQQAAC5cvPIhhz8WMVCwEEALAED27PDvM+mPxQ0mP0O0A6gAAMgahz+WbKAglQACAIBscfijIQMFCAEEAABZ4vBHwwZyHgIIAACyY9P+HP5owaB6npBTBAAAWZmu+nH4oyVDOb02mAAAIBvs+aMjz8nhB4QIAACyML3el8MfHZh+O6CQIwQAAFmwr/rxOV90qFBdCXCDAAAgeXb4n7n4joCOHVH9ASEXCAAAknbujff5pC9SclJOPiNMAACQLBv6O/XC7wQkxqoAR5Q5AgCAZDHxj4TZPMAhZYwAACBJp37+Foc/UlYo86FAAgCA5AxfvcLQH3LQV8bzAAQAAEmxvv/pl/5RQCaynQcgAABIyumX3qb0j9xkOQ9AAACQDCv92wNkplCGXw4kAABIAqV/ZM5mAfrKCAEAQBIo/cOBZ5RRK4AAAKBz9vZP6R8OFKpDQBYIAAA6Zxf+AE4cVyatAAIAgE7Zmz+lfziTRSvgoACgQwz+Na6c/FyfPDs5NHkKYRkK1VsBp5QwAgCAzthnfnn7X4qyekbVc1H1Ib82+VlqdtMgYD+PTH79yOTXWd993zLbCjiv+u9LkggAADoxHvz77XvCXEbV8/zk5/SwX5ZpgJj+62xXqA4C1ueehgLszm4JPKpEEQAAdGKV3v8spofyavWc03IP/FmUk+fc5LcL1QNvT4owsBP7a2KVgDNKEEOAAFrH2/++jVT3kQ9Xz7HqGaq7w38npep/T/aWa/8eVzVf28EzmwVIsnVCAADQutHlq7z9391I9YFvj709pnTo76asnhXVQeCECAJTdvg/rQQRAAC0jsn/XQ11821/pHwNRRDYbkUJ3g1AAADQKvb+dzRSfeh7OzCHqv+8VoXkPhZEAADQqtVX6f1vY6X9x5X/G//dlKrfgI8pdjWgr3p7IhkEAACtWbvygUaXrwlj9lZsZfJzimGkeljwrOKyWYBkBgIJAABac3btn4XxW7+V+leUx3DfMtmfr63FnVK8P/cpAgCAeM698b6CK1W/BQ8Vm2022F+HUjFY2DmtuuJTKhEEAACtsOG/9Y1NBWal/kiH3l5KxZgLGKn++z5QYggAAFoRfPjP3v5s2C9q2Xs3pfyGAPt7ba2OZP/8CAAAGmc3/wUe/rPDfyDsppS/EGCDjlbuT/IK4CkCAIDG2c1/QXH4708pHyGgVP3nYYOOyVd7CAAAGnf+jZCVbw7/2ZTKt00yHfKzXv9ImSAAAGjcuXgBgMN/PvbFw1PKy0g3h/yy+g86AQBAowK+/Vv/dyDMa6g6QKUu+SG/vRAAADQq2Nv/RdX9XyxmoLRvSBwqgyG/vRAAADTKrv8NolRid71nLsUPI5W6+dGm7JMtAQBAY2z9b+3dGAHga3/6SStbl8KyTD+UlIrshvz2QgAA0JiLQd7+P/+v7h3+5r0/DoVlS2EocKRMh/z2QgAA0JgIl/8UD9yn//n1z+QwtJYr67OP1L7tQ35rcogAAKAxEcr/VQA4PXjxn0qhSW333Kffbch6yG8vBAAAjfFeAfjMJ+8pL/yPrw2FppVqZzWwVP3G/7gCzHMQAAA0IsL0/3/90gOne2deLIU2NN0KsPsbXA357YUAAKAR3sv//+7QJ8v/8/fvDYU2NdEKGKk++LO4v3+Z0g0AB+8ZqNcrBSBLF698KM/+fv2PJ4S2lVpeK8D9kN9eekrc1ve/WQUBPSUAWTn27GueZwBK1TfBoRuvVM8RzW+kNC8aalXyLYDeX/1yUP3PE1QDgLysX9+UY6z9dWveuwFK1W/8Hj49vLAsZgB6P355qE8cOEYIAPLhfAZgJHRpVD2rmk24Ib+9ZDMEaJO2vR+9fFhbJG8gdc43AEbi7TEF+x3asw80HVPAIb+9ZLcFQEsASN/6huvy/6xvnmiGHeZn9/j91iqwWYGRcIcs1wBpCQBps48AORZyYjxRdjdAucP/fqQAN/ktKtt7AGgJAOl689qGnCpFAEiJveWfuO237RY/hvz2IfuLgGgJAOlx3AK4KKRmNHmsHWCrmeeEfXFxEyAtASAt5VW3FYCRkCJ762fIb0ZurgKmJQCkw3EFgPJ/mjj45+DuWwC0BAA0iIMGbrj8GBAtAaBb5TW3WwBUAOCG268B0hIAsGSlAEfcfw6YlgDQvvWNG3KoFOCI+wBgaAkA7XJ+EyDgQogAYGgJAFjQ7wU4EiYATNESADCn9wU4Ei4AGFoCAIDoQgYAQ0sAABBZ2AAwRUsAwD49KMCR8AHA0BIAlqt44D459GkBjhAAJmgJANhDIcARAsBtaAkA2MUhAY4QAHZASwBYzKH7DsghCwCFACcIALugJQDMr7j/Xjl1RIATBIA90BIAZnfovoNyqi/ACQLAPtASAGbjtAVgHhHgBAFgn2gJAPtXPOC2BdAXw4BwggAwI1oCwN4+fa/bFoA5LsABAsAcaAkAd3fks38ix54Q4AABYE60BIDdHfJdAbBNANoAyB4BYEG0BIA72QyA40FAO/xPCsgcAWAJaAkAd3L6PYCpJwVkjgCwJLQEgFsdeehTcsyqACsCMkYAWDJaAkDN+SCgeUrMAiBjBIAG0BIApEd8VwBMIWYBkLGe0Kit739zUP1VfkpAMOsbm3rwb16Rc+vVc7R6SgGZoQLQMFoCiMq2AJwPAhprATwjIEMEgBbQEkBU/S/crwD6ohWADBEAWsKWACJ6NEYAMNbmKwRkhADQMloCiCRIBcBYK+CC2ApARggAHaAlgCjsRsAAcwBTRfU8JyATBICO0BJAFMcfDvVS3K+epwVkgADQMVoC8O6xWAHA2EAgq79IHgEgAbQE4JldCez4w0C7GYgQgMQRABJBSwBe2eHv/LsAuxmIEICEEQASQ0sAHj3x1YcU1EDMBCBRXAWcqK2Tf1Hoo80L2toqBGTOrgU+vPqr8c+gzlXPCdVXBwNJoAKQKFoC8CRwG2DqePXYhxEKAYkgACSOlgC8eOo7n1dwherLglYEJIAAkAG2BOCB3QoYcBvgdoXqjwcxHIjOEQAyQUsAHpw88jlhbFA9l0RLAB0iAGSGlgBy9uQjBIBtCtUhgGoAOkEAyBAtAeTKWgCBPhC0XwNRDUAHCACZoiWAXDEMuKNCdQh4WgQBtIQAkDlaAsiNVQCoAuzKviPApgBaQQBwgJYAckMV4K4K1ZsCVhFYEdAQbgJ0Zuv73xxUf1cZKkLyjj37mkaXrwl7GlXP6clPYGmoADhDSwC5oAqwb33VbYELk18DS0EAcIiWAHLALMDM+iIIYIloAThHSwApsxaAtQIwl1J1a2AoYA5UAJyjJYCUWQXg+MOHhLkUujks+KRYH8SMqAAEweeFkary6nUd/cn/jfyp4GUaqq4KlAL2QAUgCC4OQqqKB+7lGwHLs6K6IsBdAtgTFYCAtn7wrZXxXADVACTk8Oqvq2rAhrBUpW6uEJYCtiEABEVLAKlhILBxQ9EewDYEgODYEkBKTr3wls6svSM0alQ9Z6vnnBAaAQC0BJAMGwQ8+pPf0ApoR6m6ImBBYF0IhwCAMVoCSAWtgNaVunndcCmEQQDALWgJIAWDl97W6V+8LbRuWD2r4rsDIRAAcAdaAuje1rD3478rxJW3XSnFLYPuEQCwI1oC6NSBg4d7Z160X9k+eyF0pRTtAbcIALgrWgJo3ZZO11dYj/VVhwB0byjaA65wEyDuim8JoF3Vf84OHhxu+1+MqueUkIIV1WHsFXHLoAtUALAvtATQjt6J8ees73RG9QdvkI5S9d+X86I9kCUCAGZCSwDN6ZXV4X/4Ln+AvXkeEVI0FHMC2aEFgJnQEkBjtrZO7PFHHBMHTKpWxEeIskMFAHOhJYDlGq/97RUATCE2A3JQio8QJY8AgIXQEsBS1Gt/5T7/6EJ1O+CQkLpSrBEmixYAFkJLAAuztb/9H/7G/lhrB3B/ffoK3WwPPCMqN0khAGBh46ntTxw4RgjA7O5Y+9uvNRECcrMigkBSaAFgqWgJYDa7rv3tl20F2EwA7YD8jHRzTgAdIABg6fiWAPZnz7W//SIE5G0kgkAnaAFg6WgJYF/2XvvbL9oBeeurDnC0BlpGBQCNoiWAne177W8WhVgR9GAotgZaQQUAjWJLADs6cM9pLV8pLgvyYEUMC7aCAIDG0RLALWZf+5tFqToErAm5W1F93wMVxIYQANAK+wd+70cvH7Z/+AuBzb32N4tSdQhYFXJng50D1RWBFWGpmAFA69gSiGzhtb9ZDcQbpCelaPMsDQEAneBbAhEtbe1vVivV87RYE/RkKAYFF0YLAJ2gJRDQ8tb+ZjWsnqPisPBkRXx5cGEEAHSKLYEotobV3+uRulOKuQBvCtWbAqx+zokAgM6xJRBAM2t/sypVvzFSdfKlr3pIkFmPGTEDgKRwcZBDtvY3rvQkpRBvjh6VYkhw36gAICm0BLxpZe1vHqXquQBaAr4Uohqwb1QAkKStH37rEhsCHrS+9jePFdUHRiF4UopqwF0dEJCYrR9+86mqbHxcyNx47a+ryf9Z2K2B56vnQdVfFoQPtva5Uj3viJshd0QLAEkZ3w+g3oqQv+7W/uZRqj4sTog3Rk8sBDwzebgH4jYEAKTlxr8MKP170Pna37yGYl3QoxXV3xUohI8RAJCM8dt/r/eEkL801v7mVao+MB4X1QBPCtUDgieFMQIA0rF54xkhf81+7a9N56rHri7m3gBfnp484REAkITxB4LqCz2QtWTX/hYxUB0EaAv4YVWA8C0BAgDSwOU/Xnh5+79dKdoC3tjGR+jLoAgA6Fy99sfgX/7Ga39D+TZtC7At4EOhuhIQcvaIAIBOsfbnSF5rf4sa6uZ8QCnkzNYDhwp4eyABAN1i7c+JbNf+FjUQa4NeDBQsBBAA0BnW/hzJe+1vUaXq+QAGBfM3UH1pUAgEAHSHtT8f/Kz9LaoUQcCDlep5TgFuDiQAoBOs/Xnhcu1vUaUIArmzb5HYhoDrEEAAQDdY+/OCt//dlboZBM6KYcHcTNcE3YYAPgeM1k2+9jcQMjde+zss7JcdJPZmyaeH82JfErRBz3U5QwUArWLtz5FYa3/LYAfIUDfvERgJOXBbCSAAoF2s/TkRdu1vWYaq3ypZIcyDhYDn5AwBAK1h7c+R2Gt/yzTSrQODpZCqvpytCBIA0B7W/nxg7a8JpeogcFRcM5yyFTm6LIgAgFaw9ucFa38NY04gfQPVXxPMHgEA7WDtzwve/tszVD0jwH0C6Xla9UZH1lgDRONY+/OCtb+OFarfPB8Ta4QpsGqNtWxKZYoKABrF2p8jrP11rVQdAPgccRpsLTDr9UACAJrF2p8TrP0lZqg6CFiL4JzQlUIZbwYQANAY1v4cYe0vVaPqeVzMCXTJZgGyHAokAKA5rP35wNpfDkrdvE+A9kD7bCiwr8wQANAI1v68YO0vM6VuXSNcE9piLzxZzQMQANAM1v684O0/X0PVU+pcN9yOQnUlIBsHBCzZZO0v+x1ZjNf+mPzPX6l6UNBCwIOq31Jdf+e+Q/bNgIvV81tlgAoAloq1P0dY+/OmVD0nYBUB5gSak00rgACA5WLtzwnW/hwrdeucQCkskx3+WQxAcxMglmb89r9545LgQK/UgQPH6P+HYS27J8Xg7jJZpWWkhFEBwPKw9ufI1jjMjec5EIHNCBxTBodWRpJvBVABwFLUa39bBACXtoZ2ERDVgFD6qg+wQliEXaA1UKKoAGA5WPtzrLeizc0L9YAnghiJGYFlsLZKoUQRALCweu2PwT/faAkENRRBYBHWAkj2bgBaAFjI+K3wo80LBIBIaAkENqgeQuDskpytoAKAxbD2FxAtgcAG4sND80gyNFEBwNxY+0P1T5BB70e/5EuBMdnqoJW3C2E/kqsCUAHA/Fj7w5YGWz/4xjNUA0Ky1UGrBhAA9ye5KgAVAMyFtT/ciouDgiuq54KoBuwlqSoAFQDMh7U/3IItgeBKUQ3Yj6T++0EFADObfO1vIGBHbAkEV4hqwN0kUwWgAoCZ8LU/7I0tgeBKUQ24m2Q+lU4AwGxY+8O+0BLAuEr4uLhA6HZPKJFvBNACwL6x9of50BIIrqie56rniDCVxDcCqABg/1j7w1xoCQRXVs/R6jkrTD2pBBAAsC/12h/fCse8aAlAJ8VcwJS1APrqGAEA+8PaH5aBi4OiG6ieC1gXnlDHmAHAnlj7w/JxcVBwNg9gcwGF4rIQdFgdhiEqALgr1v7QDFoCwa2p3ocvFZe1ATpdCSQA4O5Y+0OTaAlEVooQ0GkbgBYAdsXaH9pDSyCwonpeUSK78S3rtA1ABQC7Y+0PraElEFipuhIQcTCw0zYAAQA7Yu0PnaAlEJXNBJxSTI+qIwQA7Iy1P3SGi4OCGirmPQFUAJCOeu2PwT90iZZAUIPqOadYOrsUiACAW7D2h6TQEojohOJtBvTVAQIAbsXaH5JDSyAYGwaMNhTYyRwAAQAfG/8Dttfr/HpK4E60BIIpFWsewG5GbH0NkgCAm1j7Q+poCURypnpGisEO/9Y/l0wAwBhrf8gHLYFAbB4gSiuAAICOsPaHrNASCKJUnFZAXy3jKmDwtT9kbmuoA/ec5hph1+xK8kK+WaXjQbWIABDcuIz60eYFJv+RN74l4Fy/ei7IP/suQKmW0AKIjrU/uEBLwLmRYgwEtjoHQAUgML72B59oCTjVl/8qgH0P4YxaQgUgMtb+4BJbAk6N5L8K8IhaRAAIirU/+EZLwKnz8q2vFtECCGrrh9+6RO8fMdAScMQuzLmkDm7Na1Fr5zIVgID42h9ioSXgiK3Krcq3Qi0hAATD1/4QEy0BR7x/Lri1TQACQDSs/SEyviXgwUi+rwdurb1BAAiEr/0BhpaAA56HAQu1hAAQCWt/wAQtgcwN5deX1RK2AIKo1/62CADAHdgSyJDnbYBR9RxTC6gARMHX/oBd0BLIkM0ArMmnQi0hAATA2h+wF1oCGXpePrVW1aAF4Bxf+wNmRUsgE335/TZAK2czFQDvWPsDZkRLIBNeWwCmUAsIAI6x9gfMi5ZABmwOoBTmRgDwjLU/YDFcHJS6i/KplTkAAoBTfO0PWBZaAgkr5RMBAAtg7Q9YIloCifI8B9A4AoBDrP0BDaElkJpSPhVqAQHAGb72B+xs7coHWg5aAgkphbkRALxh7Q/Q+samRpev6dQLb+nYs6/pwb9Z0+M/fV3LQ0sgEZ6/Cti4g4Ib4zeSzRus/SGc8tqGRr/7gy5Wb/mj313b8W1/feOGlq5uCRRcHNQZAsACCACesPaHIOyAf756w197tzrwL/9B5dWNff3fWVAo7r9PyzVuCfSrAH6MENCJUi3en+8JAcCJydf++gKcsXK+Hfj2dn/u9fXq1x/O/TZfXr3eQAAwH7cEBr0f/fK0gAwQALywtb8tAdmb9u9vvuFf07K8aZWCL9yvxtAS6AJtgDkRABxg7Q85m/bvn798daZy/nz/WtfVPFoCLSMAzIkAkLnJ1/5WxOs/MmFv9NNhPTvwGxnO20WT4eJWtASQPgJA7mztr9crBCRo2r8//8b6uJy/SP9+Gdbe/VCtoiWAhBEAMsbaH1Kzn3W8Ltm/v/bREsDMSrWAAJAz1v7QsXnX8bpiFQl7Dt13QO2iJYD0EAAyxdof2rbMdbwuWRXgyH2fUidoCTShEOZCAMgVa39oWJPreF26WP25HHmoowAwRksAe2pls4EAkCHW/tC00y+9rcEv3pZHVrnofnCGlsASFfKnlQDAx4Ayw9f+0Ib2e+TtSWpOgc8LY2cEAOyAr/2hBc1cl5sGqwCkhc8LL6CQTwQA3Gr8D4hej7U/NO6RTnvkzbIKgM03pIXPC8+pkD+lWkIAyAlrf2hJ8cC9rtsAz6c60EhLYFaH5E9rVxsTADJRr/2pL6AlxQN+2wDdXAi0X7QEZlDIHwIAbmNrf0CLjjhuA9haY9poCexTIX9KtYQAkAHW/tCFI5/9E3lltxZmgZbAXh6RP2+qJQSAxLH2h64wCJgKWgJ3cUT+0ALABGt/6IjnFoBJdhBwR7QEdlDI5xDgmlpCAEgYa3/okm0BeB4EzPJqY1oC23l8+zdUACDW/tC5Iw/5nQNIfxBwN7QEJvryiQpAdKz9IQX9L94vr6wCkM8cwO1oCcjnAGBrh78hAKSKtT8kwPOVwMY+b5y12C2BvvxprfxvCAAJYu0PqXj0C34rAOb8G63+87YhIVsCffl0US0iACSGtT+kxPsg4DkXAcCEawkcl0+lWkQASA1rf0hM33EVwO4DSPta4BnFaQk8Jp+YAYiKtT+kyPONgMZHG2A79y0BW/8r5BMBICzW/pAg73MA5173FgCM65bAinyyw58hwIhY+0Oq7EZAz58GznsdcA8+WwJey/+tfQNgigCQCtb+kDDPcwBm9bdX5JerlkBffsv/I7WMAJAA1v6QOs8XAhmfbYDt3LQEVuRXq/1/0xM6NU7lH21eIAAgZXZhztG//Y08u7TydfcXH9W2hjpwz+nemRdL5aWonkvyyRLog2oZFYCusfaHDHifAzCrr76nGLJtCTwpv1p/+zcEgA6x9oecHH+49ReUVp1Ze8fvMOAdsmsJFPJ7+Y95Xh0gAHSJtT9kxPs6oB3+5994X6HksyVgL0qF/BqpAwSAjrD2h9wcf/iQvBuGaQNsl3xLoJDv4T/r/4/UAQJAV1j7Q2ZsBsD7OqDdCWBPPEm3BLy//XfS/zcEgA6w9odceV8HNKd/8bbCSq8lUFTPQL6tqiMEgJbxtT/k7LEAbQCrAKy+6vlioL2MWwJ9pWEg/0bqCAGgbaz9IWO2Duj588BTJ194K9BGQLJWVJf/PbPyf6mOEABaxNofPFj56p/KOzv8Q7cCuldUT4Q5qU7W/6YIAG1i7Q8OeF8HnDpz8Z2gA4FJGMj34N/UUB0iALSEtT94YZsAEdoA5sTPSloB7VuR/9K/KdXhBoAhALSFtT84EqENYMqrG1UI8Hr9fJIKxSj9m/PqGAGgBaz9wZsobQBz7o11nV17R2icrZhcUIzSvxmqYwSAhrH2B4+sDeD9UqDtbCvAvoiIRtmbf6EY1tRx+d8QAJrG2h+cOv4V/3cCbPf4T19Xee260Ag7/E8qjrNKAAGgQaz9wbMn/sNDisTmAY49+xpDgctnn/kdKJaREkAAaBJrf3AswrcBbmch4PGf/oOwNPaCdEaxDNXh5T/bEQAawtofInjqO59XNHY3gK0HYmF2+A8VT2d3/9+OANAU1v4QgFUArBIQzfDVK4SAxUQ9/EslUv43BIAGsPaHSE4e+ZwiIgTMLerhb04rIQSAJWPtD9E8+cjnQlYBjIWAo3/7G7YD9s8qo0PFVCqxP3cCwLKx9odg7PBf+WqsjYDt7H4A2w4gBOzpacWb9t8umd7/FAFgiVj7Q1SPPRzrToDbTVcE7dZA3KFQfcNfpD3/nQyVGALAMrH2h6Ci3Qy4k+mKIJ8RvkVf9eHfV2xDJbL6tx0BYElY+0N0EVcCdzJ46W0dXv119JaAlYSs5B/pbv+7SWr4b4oAsCys/SE4qgA3WTXg8PBXUasB/ep5RZT8p4ZK8O3fEACWgLU/oEYV4FbTasDqq1cUQKH6sOOt/1ZJvv0bAsCCWPsDbqIKcCerBqz8rBwPCdotgg5Zud8qoPbWzxD0rezwL5UoAsCiWPsDbkEVYGd2+FsIcLQtMD34L6le74u9CnKnUonfeXBQmNv47X/zBokX2GZaBXD6trsw++tiT/HAfRp8+9/o0S8+oOL+e5WRfvUcV/22z6G/u6Tf/g0BYBGs/QE7sirAqHrTxe6mrQFz/OFD4+exhx9M9VZFO+hXqucxse20H6UyuPGQADCneu1vqy8Ad6AKMBtrCdRtgXL81+34Vw7p0ernkYc+pQ71q+fRyc++MItkB/+26wlz2frhty7R+wd2V169rsOrvxLmd+i+g1UI+BP1v3i/HqnCQPHAvY2EgvLahtbe/VBvVj9Hv7MWxR+0vnFDmMuwek4oAwSAOdRrf6HvtAb25dQLb+nM2jvCclkIsFaBBQKbJbBff/reg+OfO7UQ1jc2x4+xQ95+bS0IC2l2YRGH/dJYGeeoEu/9TxEAZjQe/Pto8wJv/8De7KCxKsD08AGcO1U9Z5QJ1gBnxdofsG/2NspaIIIoldHhb6gAzGCy9ndJAGbi+BIcYOqwMin9T1EBmAVrf8BcqALAueR3/neS5MJpiiZf++PjFsAcbFDt99c39eI//T8Bzlysnu8pQ1QA9ouv/QELeerbnx8HAcCRUvWtiFkiAOwDX/sDFmcDgc98txDgSJal/ylaAHsYD/5tbdlkJ3deAwuiFQBHzlbP/1bGqADshbU/YKloBcCBUg5mwggAdzF+++/1+NofsETWCnjuv31FQKbK6jkmBwgAd8PaH9AIu8r26f/yJQEZstv+SjnADMAuWPsDmvUXf/avdfHKB/rt+38UkAkb+vtrOUEFYDes/QGNe+a7h5kHQC5s6G8gRwgAO2DtD2jHdB5gpy/YAQmxy37cVYT5b91tWPsD2vVnn7pn/Jx/Y11Agsrq+UvVn/p1hQrA7Vj7A1q38tWH+F4AUlSqnvgv5RAVgG0mb/9M/gMd6H/hfpXXro8HA4EElHJ8+BsqANux9gd06sx//tJ4RRDomJX7H5fjw98QACYma399AehMPRT4b9kMQJfs8Lc3/zU5RwCYYu0PSELxwL268PifEwLQhTCHvyEAiLU/IDWEAHQg1OFvwgeA8eCfeisCkBQLAdwRgJaEO/wNFQDW/oBk2UDghf/+54QANCnk4W96Cmz89r9545IAJG3tygc69uxrWt/YFLBEpZyv+t1N7AoAa39AFqwS8Mr3/iMzAVimUoEPfxM2ALD2B+SFwUAskd3tH/rwN3ErAKz9AdkhBGAJVlW//JUKLmQAYO0PyJeFgFe+9zUdf5jvdWFmp6tnRQ4/7DOPcKO1fO0PyN8nD35C3/v3nxmPMT9/+ZqAPdiB/7+q54zwsYOKxtb+er1CALI3+PbnxyuCp37+loBdlKLfv6NQa4Cs/QE+lVev69hzr1U/NwRsc656ToiS/45izQCw9ge4NB0OZC4AE3bgn1L9RT8O/12EmQGYrP2dFACXrBXAXABUl/r/UvXbP+4iTgWAtT8gBJsLuPTEf2JVMKaz1XNUAa/1nUeICkC99qfjAhCCVQNOHvkc1YA4StXl/r+unj8K++J+CHA8+PfR5gX2/oGYGBB0z3b7bb2PXv+M/LcA+NofEJoNCF564ut66jufF1wZqS73D8ThPxfXFQDW/gBsZ9WA0y+9reGrV4RsTSf8h8JCfFcAWPsDsI1VA575bjF+GBLMjh38Vu4/LA7/pXBbAajX/rYIAAB2ZZWA0y/9I/MB6bPp/oEo9S+V3wDww29dovcPYD8IAskaqn7rL4Wlc7kGyNofgFkc+eynxmuD1iK4eOVDrW9sCp2xt/yfqF7rWxVv/Y1xVwFg7Q/AoqgIdMIOeiv1s9LXEn8B4PvfGKrXe0IAsKDR5Ws6e/EdnXud86hBo+o5r7rcz1/oFrkKAKz9AWiCrQ+Og8Ab61QFlsMOeivv2339I6ETvgLAD755ofrRFwA0xKoCq6++Nw4D6xs3hJmMxNt+MtwEANb+ALTNQsD56iEM3NVIHPpJ8hMAWPsD0CGrDFgYsJ9r736gwOyQt9L+85OfHPqJchEAJmt/AwFAAmxmYHT5qp6//AetXfnAeyCwA36k+sC3n3yKNxPZBwDW/gCkzu4VsMrAxSoM1BWCD3NtGdhhX6o+7O2gH4lLerKVfwBg7Q9AhiwUWHXAQoFVDNYmPxPZMpge9HbIvzn59Ugc9q5kHQBY+wPgUXltYxwGLCS8Wf3aflowWL+++fEthfb7jf32XtWE7R8+stsOxz/vv/fj3/fl++/TofsOjH9fMf71wRO9H788FFw7qJzxtT8ADtkhbA/QpGw/B1yv/bHzDwDAPLINAFXz4ikBAIC5ZBkA6rU/pv4BAJhXdgFgPPin3ooAAMDc8qsA3PiXAW//AAAsJqsAMH77Z+cfAICF5VUBYO0PAIClyCYAsPYHAMDy5FMBYO0PAIClySIAsPYHAMByJR8AWPsDAGD50q8AsPYHAMDSJR0AWPsDAKAZaVcAWPsDAKARyQYA1v4AAGhOuhWArY/6AgAAjcj3c8AAAGBuBAAAAAIiAAAAEBABAACAgAgAAAAERAAAACAgAgAAAAERAAAACIgAAABAQAQAAAACIgAAABAQAQAAgIAIAAAABEQAAAAgIAIAAAABEQAAAAiIAAAAQEAEAAAAAiIAAAAQEAEAAICACAAAAAREAAAAICACAAAAAREAAAAIiAAAAEBABAAAAAIiAAAAEBABAACAgAgAAAAERAAAACAgAgAAAAERAAAACIgAAABAQAQAAAACIgAAABAQAQAAgIAIAAAABEQAAAAgIAIAAAABEQAAAAiIAAAAQEAEAAAAAiIAAAAQEAEAAICACAAAAAREAAAAICACAAAAAf1/Mpn0yHNL0VgAAAAASUVORK5CYII\u003d"
  },
  "description": "Use this tag for writing data to the Stape Store.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "documentKey",
    "displayName": "Document Key",
    "simpleValueType": true,
    "help": "The key of the document. If the key is empty, a document will be created with a randomly generated ID. If the key is to a document and it does not exist, it will be created."
  },
  {
    "type": "CHECKBOX",
    "name": "addEventData",
    "checkboxText": "Add Event Data",
    "simpleValueType": true,
    "help": "Add all Event Data to the document. If Event Data and Custom Data have the same field, the Custom Data value will be used for that field. In other words, you can override Event Data values with Custom Data."
  },
  {
    "type": "CHECKBOX",
    "name": "storeMerge",
    "checkboxText": "Merge document keys",
    "simpleValueType": true,
    "help": "If checked then merge the keys from the input into the document, otherwise the method will override the whole document."
  },
  {
    "type": "CHECKBOX",
    "name": "addTimestamp",
    "checkboxText": "Add Timestamp",
    "simpleValueType": true,
    "help": "This option will add the millisecond timestamp to the document."
  },
  {
    "type": "CHECKBOX",
    "name": "skipNilValues",
    "checkboxText": "Skip null or undefined values",
    "simpleValueType": true,
    "help": "This option allows skipping items from customDataList with undefined or null values."
  },
  {
    "type": "TEXT",
    "name": "timestampFieldName",
    "displayName": "Timestamp field name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "addTimestamp",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "^[A-Za-z0-9_]*$"
        ],
        "errorMessage": "Letters, numbers and underscores are allowed"
      }
    ],
    "defaultValue": "timestamp"
  },
  {
    "displayName": "Custom Data",
    "name": "customDataListGroup",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "name": "customDataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Field Name",
            "name": "name",
            "isUnique": true,
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Field Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const JSON = require('JSON');
const getRequestHeader = require('getRequestHeader');
const getAllEventData = require('getAllEventData');
const getTimestampMillis = require('getTimestampMillis');
const logToConsole = require('logToConsole');
const getContainerVersion = require('getContainerVersion');
const getType = require('getType');
const sendHttpRequest = require('sendHttpRequest');
const encodeUriComponent = require('encodeUriComponent');
const makeString = require('makeString');
const generateRandom = require('generateRandom');

const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = isLoggingEnabled ? getRequestHeader('trace-id') : undefined;


let storeUrl = getStoreUrl();
let writeUrl = getWriteUrl(data.documentKey || generateDocumentKey());
let method = data.storeMerge ? 'PATCH' : 'PUT';
let input = data.addEventData ? getAllEventData() : {};

if (data.addTimestamp) input[data.timestampFieldName] = getTimestampMillis();
if (data.customDataList) {
    data.customDataList.forEach((d) => {
        if (data.skipNilValues) {
            const dType = getType(d.value);
            if (dType === 'undefined' || dType === 'null') return;
        }
        if (getType(d.name) === 'string' && d.name.indexOf('.') !== -1) {
            const nameParts = d.name.split('.');
            let obj = input;
            for (let i = 0; i < nameParts.length - 1; i++) {
                const part = nameParts[i];
                if (!obj[part]) {
                    obj[part] = {};
                }
                obj = obj[part];
            }
            obj[nameParts[nameParts.length - 1]] = d.value;
        } else {
            input[d.name] = d.value;
        }
    });
}

if (isLoggingEnabled) {
    logToConsole(
      JSON.stringify({
          Name: 'StapeStore',
          Type: 'Request',
          TraceId: traceId,
          EventName: 'Store',
          RequestMethod: method,
          RequestUrl: writeUrl,
          RequestBody: input,
      })
    );
}

sendHttpRequest(writeUrl, {method: method, headers: { 'Content-Type': 'application/json' }}, JSON.stringify(input))
  .then(() => {
      if (isLoggingEnabled) {
          logToConsole(
            JSON.stringify({
                Name: 'StapeStore',
                Type: 'Response',
                TraceId: traceId,
                EventName: 'Store',
                ResponseStatusCode: 200,
                ResponseHeaders: {},
                ResponseBody: {},
            })
          );
      }

      data.gtmOnSuccess();
  }, function () {
      if (isLoggingEnabled) {
          logToConsole(
            JSON.stringify({
                Name: 'StapeStore',
                Type: 'Response',
                TraceId: traceId,
                EventName: 'Store',
                ResponseStatusCode: 500,
                ResponseHeaders: {},
                ResponseBody: {},
            })
          );
      }

      data.gtmOnFailure();
  });


function getStoreUrl() {
    const containerIdentifier = getRequestHeader('x-gtm-identifier');
    const defaultDomain = getRequestHeader('x-gtm-default-domain');
    const containerApiKey = getRequestHeader('x-gtm-api-key');

    return (
      'https://' +
      enc(containerIdentifier) +
      '.' +
      enc(defaultDomain) +
      '/stape-api/' +
      enc(containerApiKey) +
      '/v1/store'
    );
}

function getWriteUrl(documentKey) {
    return storeUrl + '/' + enc(documentKey);
}

function generateDocumentKey() {
    const rnd = makeString(generateRandom(1000000000, 2147483647));

    return 'store_' + makeString(getTimestampMillis()) + rnd;
}

function enc(data) {
    data = data || '';
    return encodeUriComponent(data);
}



function determinateIsLoggingEnabled() {
    const containerVersion = getContainerVersion();
    const isDebug = !!(containerVersion && (containerVersion.debugMode || containerVersion.previewMode));

    if (!data.logType) {
        return isDebug;
    }

    if (data.logType === 'no') {
        return false;
    }

    if (data.logType === 'debug') {
        return isDebug;
    }

    return data.logType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "x-gtm-identifier"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "x-gtm-default-domain"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "x-gtm-api-key"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 23/01/2024, 12:40:30


